# minions-openclaw v0.1 Specification

## Overview

`minions-openclaw` is a production-quality monorepo for managing OpenClaw Gateway instances. It uses [minions-sdk](https://www.npmjs.com/package/minions-sdk) for structured data management (minions and relations).

## Data Model

All persistent data is stored in `~/.openclaw-manager/data.json` as a flat JSON object with two arrays: `minions` and `relations`.

### MinionType Registry

The following custom MinionTypes are registered:

| Slug | Description |
|---|---|
| `openclaw-instance` | A registered OpenClaw Gateway instance |
| `openclaw-snapshot` | Point-in-time state capture |
| `openclaw-agent` | An agent definition |
| `openclaw-channel` | A communication channel |
| `openclaw-model-provider` | A model provider configuration |
| `openclaw-skill` | A skill available to agents |
| `openclaw-tool-config` | Tool configuration |
| `openclaw-session-config` | Session configuration |
| `openclaw-gateway-config` | Gateway network configuration |
| `openclaw-talk-config` | Voice/talk configuration |
| `openclaw-browser-config` | Browser automation configuration |
| `openclaw-hook` | Webhook configuration |
| `openclaw-cron-job` | Scheduled job |
| `openclaw-discovery-config` | mDNS discovery configuration |
| `openclaw-identity-config` | Device identity configuration |
| `openclaw-canvas-config` | Canvas UI configuration |
| `openclaw-logging-config` | Logging configuration |
| `openclaw-ui-config` | Web UI configuration |

## Connection Protocol

The `GatewayClient` implements the OpenClaw WebSocket protocol:

1. Client opens WebSocket connection to `ws://<host>:<port>`
2. Server sends `connect.challenge` with `{ nonce, timestamp }`
3. Client signs `nonce:timestamp` with RSA private key (or empty string)
4. Client sends `connect` with `{ role, scopes, signature, timestamp, nonce }`
5. Server responds with `hello-ok` (success) or `hello-error` (failure)
6. Authenticated client calls methods via `{ type: "call", id, method, params }`
7. Server responds with `{ type: "response", id, payload }`

## Config Decomposition

The `ConfigDecomposer` reads `openclaw.json` and maps each config section to a MinionType:

- `agents[]` → `openclaw-agent` minions
- `channels[]` → `openclaw-channel` minions
- `modelProviders[]` → `openclaw-model-provider` minions
- `skills[]` → `openclaw-skill` minions
- `tools[]` → `openclaw-tool-config` minions
- `sessionConfig` → `openclaw-session-config` minion
- `gatewayConfig` → `openclaw-gateway-config` minion
- `talkConfig` → `openclaw-talk-config` minion
- `browserConfig` → `openclaw-browser-config` minion
- `hooks[]` → `openclaw-hook` minions
- `cronJobs[]` → `openclaw-cron-job` minions
- `discoveryConfig` → `openclaw-discovery-config` minion
- `identityConfig` → `openclaw-identity-config` minion
- `canvasConfig` → `openclaw-canvas-config` minion
- `loggingConfig` → `openclaw-logging-config` minion
- `uiConfig` → `openclaw-ui-config` minion

All child minions are linked to the parent instance via `parent_of` relations.

## Snapshot Management

Snapshots are captured by:
1. Connecting to the gateway via WebSocket
2. Calling `agents.list`, `channels.list`, `models.list`, `system-presence`
3. Creating an `openclaw-snapshot` minion with the captured data
4. Linking to the parent instance via `parent_of`
5. Linking to the previous snapshot (if any) via `follows`

## Security Model

- Auth tokens are stored in `~/.openclaw-manager/data.json`
- RSA device keys can be stored per-instance for challenge-response auth
- File permissions should be `600` for data file
- Tokens are transmitted over WebSocket in the `Authorization: Bearer` header

## CLI Interface

```
openclaw-manager register <name> --url <url> [--token <token>]
openclaw-manager ping <instanceId>
openclaw-manager snapshot <instanceId>
openclaw-manager list
openclaw-manager history <instanceId>
openclaw-manager agents <instanceId>
openclaw-manager channels <instanceId>
openclaw-manager models <instanceId>
openclaw-manager config show <instanceId>
openclaw-manager config diff <id1> <id2>
openclaw-manager config export <instanceId>
openclaw-manager config import <instanceId> --file <path>
```

## TypeScript SDK

```typescript
import {
  InstanceManager, GatewayClient, SnapshotManager, ConfigDecomposer,
  registry, allOpenClawTypes, openclawInstanceType
} from '@minions-openclaw/sdk';
```

## Python SDK

```python
from minions_openclaw import (
    InstanceManager, GatewayClient, SnapshotManager, ConfigDecomposer,
    registry, ALL_TYPES, openclaw_instance_type
)
```
